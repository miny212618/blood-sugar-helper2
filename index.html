
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>血糖助手</title>
    <style>
        body { font-family: sans-serif; background: #f4fffa; padding: 20px; }
        .section { background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        input { width: 100%; padding: 8px; margin: 5px 0; }
        .output { font-weight: bold; margin-top: 10px; color: green; }
        .record-list { white-space: pre-line; background: #eef; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>血糖助手</h1>
    <div class="section">
        <label>血糖修正因子（每 1U 可降幾 mg/dL）</label>
        <input type="number" id="factor" value="100">
        <label>目標血糖（mg/dL）</label>
        <input type="number" id="target" value="100">
    </div>

    <div class="section">
        <h2>紀錄輸入</h2>
        <label>餐前血糖（mg/dL）</label>
        <input type="number" id="sugar">
        <label>碳水化合物（g）</label>
        <input type="number" id="carbs">
        <label>碳水比（CI 值）</label>
        <input type="number" id="ci" value="10">
        <label>實際打的胰島素劑量</label>
        <input type="number" id="dose">
        <label>備註（吃什麼）</label>
        <input type="text" id="note">
        <button onclick="calculate()">計算並儲存</button>
        <div class="output" id="recommend"></div>
        <div class="output" id="estimated"></div>
    </div>

    <div class="section">
        <h2>今日紀錄</h2>
        <div class="record-list" id="recordList"></div>
    </div>

    <script>
        function calculate() {
            const factor = parseFloat(document.getElementById("factor").value);
            const target = parseFloat(document.getElementById("target").value);
            const sugar = parseFloat(document.getElementById("sugar").value);
            const carbs = parseFloat(document.getElementById("carbs").value);
            const ci = parseFloat(document.getElementById("ci").value);
            const dose = parseFloat(document.getElementById("dose").value);
            const note = document.getElementById("note").value;

            const recommendDose = ((sugar - target) / factor) + (carbs / ci);
            const estimatedSugar = sugar - ((dose - (carbs / ci)) * factor);

            document.getElementById("recommend").innerText = "建議胰島素：" + recommendDose + " 單位";
            document.getElementById("estimated").innerText = "預估血糖：" + estimatedSugar + " mg/dL";

            saveRecord(sugar, carbs, ci, dose, note, recommendDose, estimatedSugar);
        }

        function saveRecord(sugar, carbs, ci, dose, note, recommendDose, estimatedSugar) {
            const today = new Date().toISOString().split("T")[0];
            const record = {
                sugar, carbs, ci, dose, note,
                recommendDose, estimatedSugar
            };

            let records = JSON.parse(localStorage.getItem(today) || "[]");
            records.push(record);
            localStorage.setItem(today, JSON.stringify(records));
            showRecords();
        }

        function showRecords() {
            const today = new Date().toISOString().split("T")[0];
            const records = JSON.parse(localStorage.getItem(today) || "[]");
            let display = "";
            records.forEach((r, i) => {
                display += `#${i+1} 餐前血糖：${r.sugar}，碳水：${r.carbs}g，CI：${r.ci}，施打：${r.dose}U，備註：${r.note}
建議：${r.recommendDose}U，預估：${r.estimatedSugar} mg/dL

`;
            });
            document.getElementById("recordList").innerText = display;
        }

        window.onload = showRecords;
    </script>
</body>
</html>
