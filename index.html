
<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>血糖助手紀錄版</title>
<link href="favicon.ico" rel="icon" type="image/x-icon"/>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #eaffea; }
    input, button { margin: 5px 0; padding: 5px; width: 100%; max-width: 300px; }
    .section { margin-bottom: 30px; }
    .record-box { background: #eef; padding: 10px; margin-top: 10px; white-space: pre-wrap; }
    .record-entry { margin-bottom: 10px; }
    .record-buttons { margin-top: 5px; }
  </style>
<link href="manifest.json" rel="manifest"/></head>
<body>
<h2 style="text-align: center;">血糖助手</h2>
<div class="section">
  餐前血糖（mg/dL）<br/>
<input id="preMealBloodSugar" oninput="autoCalculate()" type="number"/><br/>

  目標血糖（mg/dL）<br/>
<input id="targetBloodSugar" oninput="autoCalculate()" type="number" value="100"/><br/>


  早餐 CI 值：<br/>
<input id="breakfastCI" type="number" value="8"/><br/>

  午餐 CI 值：<br/>
<input id="lunchCI" type="number" value="10"/><br/>

  晚餐 CI 值：<br/>
<input id="dinnerCI" type="number" value="10"/><br/>

  選擇餐別：<br/>
<select id="mealType" onchange="updateCIFromMeal()">
<option value="breakfast">早餐</option>
<option value="lunch">午餐</option>
<option value="dinner">晚餐</option>
</select><br/>

  
  血糖修正因子（每 1U 可降幾 mg/dL）<br/>
<input id="correctionFactor" oninput="autoCalculate()" type="number" value="100"/><br/>

  碳水化合物（g）<br/>
<input id="carbs" oninput="autoCalculate()" type="number"/><br/>

  碳水比（CI 值）<br/><br/>
<input id="carbRatio" oninput="autoCalculate()" type="number"/><br/>

  實際打的胰島素劑量<br/>
<input id="actualInsulin" oninput="autoCalculate()" type="number"/><br/>

  備註（吃什麼）<br/>
<input id="note" type="text"/><br/>
<button onclick="saveRecord()">儲存資料</button><br/><br/>
<div id="suggestedInsulin" style="font-weight:bold; color:green;"></div>
<div id="predictedBloodSugar" style="font-weight:bold; color:green;"></div>
</div>
<h3>今日紀錄</h3>
<div class="record-box" id="records"></div>
<button onclick="copyRecords()">複製今日紀錄</button>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const mealSelect = document.querySelector('select[name="meal"]');
    const ciInput = document.querySelector('input[name="ci"]');

    function getSuggestedCI(meal) {
        const day = new Date().getDay(); // 0=日, 1=一, 2=二 ...
        if (day === 2 && meal === "breakfast") return 8;
        if (day === 2 && meal === "lunch") return 10;
        if (day === 2 && meal === "dinner") return 10;
        if (day === 1 && meal === "breakfast") return 9;
        return "";
    }

    function updateCI() {
        if (!mealSelect || !ciInput) return;
        const selectedMeal = mealSelect.value;
        const ciValue = getSuggestedCI(selectedMeal);
        if (ciValue !== "") {
            ciInput.value = ciValue;
        }
    }

    mealSelect?.addEventListener("change", updateCI);
    updateCI(); // 頁面載入時自動執行
});
</script>
</body>
</html>
