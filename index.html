
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>血糖助手</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #eaffea; }
        input, button { margin: 5px 0; padding: 5px; width: 100%; max-width: 300px; }
        .section { margin-bottom: 30px; }
        .record-box { background: #eef; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>

<h2 style="text-align: center;">血糖助手</h2>

<div class="section">
    餐前血糖（mg/dL）<br>
    <input type="number" id="preMealBloodSugar" oninput="autoCalculate()"><br>

    目標血糖（mg/dL）<br>
    <input type="number" id="targetBloodSugar" value="100" oninput="autoCalculate()"><br>

    血糖修正因子（每 1U 可降幾 mg/dL）<br>
    <input type="number" id="correctionFactor" value="100" oninput="autoCalculate()"><br>

    碳水化合物（g）<br>
    <input type="number" id="carbs" oninput="autoCalculate()"><br>

    碳水比（CI 值）<br>
    <input type="number" id="carbRatio" oninput="autoCalculate()"><br>

    實際打的胰島素劑量<br>
    <input type="number" id="actualInsulin" oninput="autoCalculate()"><br>

    備註（吃什麼）<br>
    <input type="text" id="note"><br>

    <button onclick="saveRecord()">儲存資料</button><br><br>

    <div id="suggestedInsulin" style="font-weight:bold; color:green;"></div>
    <div id="predictedBloodSugar" style="font-weight:bold; color:green;"></div>
</div>

<h3>今日紀錄</h3>
<div id="records" class="record-box"></div>

<script>
let recordIndex = 1;

function autoCalculate() {
    const cf = parseFloat(document.getElementById("correctionFactor").value);
    const target = parseFloat(document.getElementById("targetBloodSugar").value);
    const pre = parseFloat(document.getElementById("preMealBloodSugar").value);
    const carbs = parseFloat(document.getElementById("carbs").value);
    const ci = parseFloat(document.getElementById("carbRatio").value);
    const actual = parseFloat(document.getElementById("actualInsulin").value);

    let suggested = "";
    let predicted = "";

    if (!isNaN(pre) && !isNaN(carbs) && !isNaN(ci) && !isNaN(cf) && !isNaN(target)) {
        suggested = ((pre - target) / cf + carbs / ci);
        document.getElementById("suggestedInsulin").innerText = `建議胰島素：${suggested.toFixed(2)} 單位`;
    }

    if (!isNaN(pre) && !isNaN(carbs) && !isNaN(ci) && !isNaN(actual) && !isNaN(cf)) {
        predicted = pre - (actual - (carbs / ci)) * cf;
        predicted = Math.floor(predicted);
        document.getElementById("predictedBloodSugar").innerText = `預估血糖：${predicted} mg/dL`;
    }
}

function saveRecord() {
    const pre = document.getElementById("preMealBloodSugar").value;
    const carbs = document.getElementById("carbs").value;
    const ci = document.getElementById("carbRatio").value;
    const actual = document.getElementById("actualInsulin").value;
    const note = document.getElementById("note").value;

    const suggestedText = document.getElementById("suggestedInsulin").innerText.split("：")[1] || "null";
    const predictedText = document.getElementById("predictedBloodSugar").innerText.split("：")[1] || "null";

    const record = `#${recordIndex} 餐前血糖：${pre}，碳水：${carbs}g，CI：${ci}，施打：${actual}U，備註：${note}<br>建議：${suggestedText}，預估：${predictedText}<br><br>`;

    document.getElementById("records").innerHTML += record;
    recordIndex++;
}
</script>

</body>
</html>
